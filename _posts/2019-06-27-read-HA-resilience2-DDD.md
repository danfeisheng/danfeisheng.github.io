---
layout: post
title: "读《高可用可伸缩微服务架构》感"
date: "2019-06-27 22:39"
author: "Danfei"
---
2019-06-27 22:39

读《高可用可伸缩微服务架构》感

第二章 微服务领域驱动设计

领域驱动设计（Domain Driven Design，DDD）

微服务的技术维度：诸如服务设计原则的遵守，通信机制的选择，数据一致性的保障，健康状态的监控与跟踪，乃至于服务的配置，测试与运维。

微服务的业务维度：普遍达成的共识是从业务角度驱动服务的识别与分解（服务的拆分粒度），拆的过细，因为微服务的边界为完全独立的跨进程通信边界，
会增加各微服务间的通信成本和运维成本，拆的过粗，又达不到单独伸缩和运维的目的。如何拆分，就要使用到领域驱动设计。

界限上下文的含义就是用一个清晰可见的边界（Bounded）将上下文勾勒出来，如此就能在自己的边界内维持领域模型的一致性和完整性，用细胞来形容界限上下文，
细胞膜限定了什么在细胞内，什么在细胞外，并且确定了什么物质可以通过细胞膜，这里细胞代表上下文，而细胞膜代表了包裹上下文的边界。

分析上下文的本质，就是对边界的控制，观察角度的不同，限定上下文划定的边界也有所不同，大体可分为如下三个方面：

	+ 领域逻辑层面：限定上下文确定了领域模型的业务边界，维护了模型的完整性与一致性，从而降低系统的业务复杂度
	+ 团队合作层面：限定上下文确定了开发团队的工作边界，建立了团队之间的合作模式，避免团队之间的沟通变得混乱，从而降低系统的管理复杂度
	+ 技术实现层面：限定上下文确定了系统架构的应用边界，保证了系统层和上下文领域层各自的一致性，建立上下文之间的集成方式，从而降低系统的技术复杂度
	
** 这三种边界体现了界限上下文对不同边界的控制力，业务边界是对领域模型的控制，工作边界是对开发协作的控制，应用边界是对技术风险的控制 **

界限上下文是“分而治之”架构原则的体现，引入它的目的其实是为了控制软件的复杂度，在识别界限上下文时，将它看做一个由业务驱动的抽象单元，并通过它帮我们
设计出高内聚，低耦合的设计。一旦确定了界限上下文，我们再来思考它的边界及他们之间的协作关系。

六边形架构又称为 端口-适配器 模式， Rest service, Repositories, Cache等模块都扮演了适配器的角色，这些适配器将通过端口与外部资源进行通信。端口与适配器
部分都属于架构中技术实现的内容。

事件驱动架构

分析业务时，如果认为业务对象之间的协作关系是以事件的方式进行，就会改变领域建模的本质，从围绕领域概念为核心建模的方式转换为围绕 状态迁移 为核心的建模
方式，每个 事件 就是每次状态迁移时产生的事实（Fact）。倘若在架构设计时，皆以事件为媒介驱动架构的设计，并利用事件类解耦两个协作着之间的协作时，就可以
认为是事件驱动架构（Event Driven Architecture， EDA）。如果界限上下文之间采用事件进行协作，则采用的上下文映射模式就是发布者/订阅者模式。结合前面提到
的六边形架构，传递事件的就是六边形的端口，适配器负责发布/订阅事件。

如果我们将界限上下文视为一个微服务，那么事件驱动架构会将编排（Orchestration）方式的微服务协作改为协同（Choreography）方式的微服务协作，比起服务的编排，
这种围绕事件进行协作的方式会显著降低微服务之间的耦合度，同时还可以利用事件的异步本质来提高整个系统的响应速度。

** 正所谓， 越容易重用，就越容易产生耦合，在重用和解耦之间需要作出权衡 **

** 领域逻辑，团队合作与技术实现，是领域驱动设计规范微服务架构的三要素 **